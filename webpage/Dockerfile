FROM python:3.10-slim

# Args
ARG INFERENCE_SERVER_PORT=3000
ARG INFERENCE_SERVER_ADDRESS=http://eurygaster-svc:${INFERENCE_SERVER_PORT}
ARG EURYGASTER_WEBPAGE_PORT=4452
ARG EURYGASTER_WEBPAGE_IP=0.0.0.0

ARG LOGURU_INIT=1
ARG LOGURU_LEVEL=DEBUG

ARG GLITCHTIP_DSN=""
ARG GLITCHTIP_MAX_BREADCRUMBS=50
ARG GLITCHTIP_DEBUG=1
ARG GLITCHTIP_SR=1.0

# Env vars
ENV INFERENCE_SERVER_ADDRESS $INFERENCE_SERVER_ADDRESS
ENV EURYGASTER_WEBPAGE_PORT $EURYGASTER_WEBPAGE_PORT
ENV EURYGASTER_WEBPAGE_IP $EURYGASTER_WEBPAGE_IP

ENV LOGURU_INIT $LOGURU_INIT
ENV LOGURU_LEVEL $LOGURU_LEVEL

ENV GLITCHTIP_DSN $GLITCHTIP_DSN
ENV GLITCHTIP_MAX_BREADCRUMBS $GLITCHTIP_MAX_BREADCRUMBS
ENV GLITCHTIP_DEBUG $GLITCHTIP_DEBUG
ENV GLITCHTIP_SR $GLITCHTIP_SR

WORKDIR /buildspace
COPY ./eurygaster_webpage ./eurygaster_webpage
COPY  Makefile setup.py MANIFEST.in requirements.txt ./

RUN pip install .

WORKDIR /worksapce
RUN rm -rf  /buildspace

EXPOSE ${INFERENCE_SERVER_PORT}

CMD python -m eurygaster_webpage
